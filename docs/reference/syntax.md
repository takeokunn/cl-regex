# パターン構文リファレンス

CL-Regexでサポートされる正規表現構文の完全なリファレンスです。

## 基本構文

### リテラル文字

| 構文 | 説明 | 例 |
|------|------|-----|
| `a` | 文字 'a' に完全一致 | `cat` → "cat" |
| `123` | 数字の並び | `123` → "123" |
| `α` | Unicode文字 | `αβγ` → "αβγ" |

### エスケープシーケンス

| 構文 | 説明 | Unicode | 例 |
|------|------|---------|-----|
| `\.` | ピリオド | U+002E | `3\.14` → "3.14" |
| `\\` | バックスラッシュ | U+005C | `path\\file` |
| `\n` | 改行 | U+000A | `line1\nline2` |
| `\r` | 復帰 | U+000D | `\r\n` |
| `\t` | タブ | U+0009 | `\t` |
| `\f` | 改ページ | U+000C | `\f` |
| `\v` | 垂直タブ | U+000B | `\v` |
| `\0` | NULL文字 | U+0000 | `\0` |
| `\a` | ベル | U+0007 | `\a` |
| `\e` | エスケープ | U+001B | `\e` |

### Unicode エスケープ

| 構文 | 説明 | 例 |
|------|------|-----|
| `\uXXXX` | 4桁16進Unicode | `\u03B1` → "α" |
| `\UXXXXXXXX` | 8桁16進Unicode | `\U0001F600` → "😀" |
| `\xXX` | 2桁16進 | `\x41` → "A" |
| `\oXXX` | 8進数 | `\o101` → "A" |

## 文字クラス

### 基本文字クラス

| 構文 | 説明 | 等価 |
|------|------|------|
| `[abc]` | a, b, c のいずれか | |
| `[a-z]` | 小文字英字 | |
| `[A-Z]` | 大文字英字 | |
| `[0-9]` | 数字 | `\d` |
| `[^abc]` | a, b, c 以外 | |
| `[a-zA-Z]` | 英字 | |
| `[a-zA-Z0-9]` | 英数字 | `\w` |

### 定義済み文字クラス

| 構文 | 説明 | Unicode Property |
|------|------|------------------|
| `.` | 任意の文字（改行除く） | |
| `\d` | 数字 | `\p{Nd}` |
| `\D` | 数字以外 | `\P{Nd}` |
| `\w` | 単語文字 | `\p{L}\p{Nd}_` |
| `\W` | 単語文字以外 | `\P{L}\P{Nd}` |
| `\s` | 空白文字 | `\p{Z}\t\n\r\f\v` |
| `\S` | 空白文字以外 | `\P{Z}` |
| `\h` | 水平空白 | `\t\p{Zs}` |
| `\H` | 水平空白以外 | |
| `\v` | 垂直空白 | `\n\r\f\v\p{Zl}\p{Zp}` |
| `\V` | 垂直空白以外 | |

### Unicode文字プロパティ

#### General Categories

| 構文 | 説明 | 例 |
|------|------|-----|
| `\p{L}` | 文字 | a, α, あ, 字 |
| `\p{Lu}` | 大文字 | A, Α |
| `\p{Ll}` | 小文字 | a, α |
| `\p{Lt}` | タイトル文字 | Dz |
| `\p{Lm}` | 修飾文字 | ʰ |
| `\p{Lo}` | その他文字 | あ, 字 |
| `\p{M}` | マーク | ́, ̃ |
| `\p{Mn}` | 非空白マーク | ́ |
| `\p{Mc}` | 空白マーク | ो |
| `\p{Me}` | 囲みマーク | ⃝ |
| `\p{N}` | 数字 | 1, Ⅰ, ① |
| `\p{Nd}` | 10進数字 | 1, ١ |
| `\p{Nl}` | 文字数字 | Ⅰ |
| `\p{No}` | その他数字 | ① |
| `\p{P}` | 句読点 | ., ! |
| `\p{Pc}` | 接続句読点 | _ |
| `\p{Pd}` | ダッシュ句読点 | - |
| `\p{Ps}` | 開始句読点 | ( |
| `\p{Pe}` | 終了句読点 | ) |
| `\p{Pi}` | 最初引用符 | " |
| `\p{Pf}` | 最後引用符 | " |
| `\p{Po}` | その他句読点 | ! |
| `\p{S}` | 記号 | $, © |
| `\p{Sm}` | 数学記号 | + |
| `\p{Sc}` | 通貨記号 | $ |
| `\p{Sk}` | 修飾記号 | ^ |
| `\p{So}` | その他記号 | © |
| `\p{Z}` | 区切り文字 | space |
| `\p{Zs}` | 空白区切り | space |
| `\p{Zl}` | 行区切り | |
| `\p{Zp}` | 段落区切り | |
| `\p{C}` | その他 | 制御文字 |
| `\p{Cc}` | 制御文字 | \t, \n |
| `\p{Cf}` | 書式文字 | ​ |
| `\p{Cs}` | サロゲート | |
| `\p{Co}` | 私用文字 | |
| `\p{Cn}` | 未割当 | |

#### Unicode Blocks

| 構文 | 説明 | 範囲 |
|------|------|------|
| `\p{InBasic_Latin}` | 基本ラテン文字 | U+0000-U+007F |
| `\p{InLatin-1_Supplement}` | ラテン文字補助 | U+0080-U+00FF |
| `\p{InHiragana}` | ひらがな | U+3040-U+309F |
| `\p{InKatakana}` | カタカナ | U+30A0-U+30FF |
| `\p{InCJK_Unified_Ideographs}` | CJK統合漢字 | U+4E00-U+9FFF |
| `\p{InArabic}` | アラビア文字 | U+0600-U+06FF |
| `\p{InCyrillic}` | キリル文字 | U+0400-U+04FF |
| `\p{InGreek_and_Coptic}` | ギリシャ文字 | U+0370-U+03FF |
| `\p{InHebrew}` | ヘブライ文字 | U+0590-U+05FF |
| `\p{InEmoticons}` | 絵文字 | U+1F600-U+1F64F |

#### Scripts

| 構文 | 説明 |
|------|------|
| `\p{Latin}` | ラテン文字 |
| `\p{Hiragana}` | ひらがな |
| `\p{Katakana}` | カタカナ |
| `\p{Han}` | 漢字 |
| `\p{Arabic}` | アラビア文字 |
| `\p{Cyrillic}` | キリル文字 |
| `\p{Greek}` | ギリシャ文字 |
| `\p{Hebrew}` | ヘブライ文字 |

## 量詞（Quantifiers）

### 基本量詞

| 構文 | 説明 | 等価 |
|------|------|------|
| `?` | 0回または1回 | `{0,1}` |
| `*` | 0回以上 | `{0,}` |
| `+` | 1回以上 | `{1,}` |
| `{n}` | 正確にn回 | |
| `{n,}` | n回以上 | |
| `{n,m}` | n回からm回 | |

### 非貪欲量詞

| 構文 | 説明 |
|------|------|
| `??` | 非貪欲0回または1回 |
| `*?` | 非貪欲0回以上 |
| `+?` | 非貪欲1回以上 |
| `{n,}?` | 非貪欲n回以上 |
| `{n,m}?` | 非貪欲n回からm回 |

### 所有格量詞

| 構文 | 説明 |
|------|------|
| `?+` | 所有格0回または1回 |
| `*+` | 所有格0回以上 |
| `++` | 所有格1回以上 |
| `{n,}+` | 所有格n回以上 |
| `{n,m}+` | 所有格n回からm回 |

## アンカー（Anchors）

| 構文 | 説明 |
|------|------|
| `^` | 行の開始 |
| `$` | 行の終了 |
| `\A` | 文字列の開始 |
| `\Z` | 文字列の終了 |
| `\z` | 文字列の絶対終了 |
| `\b` | 単語境界 |
| `\B` | 非単語境界 |
| `\G` | 前回マッチ終了位置 |

## グループ化

### キャプチャグループ

| 構文 | 説明 | 例 |
|------|------|-----|
| `(pattern)` | キャプチャグループ | `(a+)b` |
| `(?P<name>pattern)` | 名前付きキャプチャ | `(?P<word>\w+)` |
| `(?<name>pattern)` | 名前付きキャプチャ（.NET式） | `(?<word>\w+)` |

### 非キャプチャグループ

| 構文 | 説明 |
|------|------|
| `(?:pattern)` | 非キャプチャグループ |
| `(?>pattern)` | アトミックグループ |

### フラグ

| 構文 | 説明 |
|------|------|
| `(?i)` | 大文字小文字を区別しない |
| `(?m)` | 複数行モード |
| `(?s)` | DOTALL（.が改行にマッチ） |
| `(?x)` | 拡張モード（空白無視） |
| `(?u)` | Unicode |
| `(?-i)` | 大文字小文字を区別する |

## 先読み・後読み

### 先読み（Lookahead）

| 構文 | 説明 | 例 |
|------|------|-----|
| `(?=pattern)` | 正の先読み | `\w+(?=\s)` |
| `(?!pattern)` | 負の先読み | `\w+(?!\s)` |

### 後読み（Lookbehind）

| 構文 | 説明 | 例 |
|------|------|-----|
| `(?<=pattern)` | 正の後読み | `(?<=\s)\w+` |
| `(?<!pattern)` | 負の後読み | `(?<!\s)\w+` |

### 可変長後読み（CL-Regex拡張）

| 構文 | 説明 |
|------|------|
| `(?<*pattern)` | 可変長正の後読み |
| `(?<!*pattern)` | 可変長負の後読み |

## 選択（Alternation）

| 構文 | 説明 | 例 |
|------|------|-----|
| `a\|b` | a または b | `cat\|dog` |
| `(a\|b)c` | ac または bc | `(red\|blue)car` |

## 条件付きマッチング

| 構文 | 説明 |
|------|------|
| `(?(condition)true)` | 条件付きマッチ |
| `(?(condition)true\|false)` | 条件付き選択 |
| `(?(<name>)true\|false)` | 名前付きグループ条件 |
| `(?(1)true\|false)` | 番号付きグループ条件 |

## 再帰とサブルーチン

| 構文 | 説明 |
|------|------|
| `(?R)` | 全体パターンの再帰 |
| `(?0)` | 全体パターンの再帰 |
| `(?1)` | グループ1のサブルーチン |
| `(?P>name)` | 名前付きグループのサブルーチン |

## バックリファレンス

| 構文 | 説明 | 例 |
|------|------|-----|
| `\1` | グループ1の内容 | `(a+)\1` |
| `\2` | グループ2の内容 | `(a)(b)\2\1` |
| `\k<name>` | 名前付きグループ | `(?P<word>\w+)\k<word>` |
| `(?P=name)` | 名前付きグループ | `(?P<word>\w+)(?P=word)` |

## CL-Regex 独自拡張

### マクロ構文

| 構文 | 説明 |
|------|------|
| `{:email}` | メールアドレスマクロ |
| `{:url}` | URLマクロ |
| `{:ip}` | IPアドレスマクロ |
| `{:date}` | 日付マクロ |
| `{:time}` | 時刻マクロ |

### 日本語拡張

| 構文 | 説明 |
|------|------|
| `\p{Hiragana}` | ひらがな |
| `\p{Katakana}` | カタカナ |
| `\p{Kanji}` | 漢字 |
| `\p{JapaneseWord}` | 日本語単語 |

### 数値拡張

| 構文 | 説明 |
|------|------|
| `\p{Integer}` | 整数 |
| `\p{Decimal}` | 小数 |
| `\p{Currency}` | 通貨 |
| `\p{Percentage}` | パーセント |

## モード修飾子

### インライン修飾子

| 構文 | 説明 |
|------|------|
| `(?i:pattern)` | パターン内でのみ大文字小文字無視 |
| `(?m:pattern)` | パターン内でのみ複数行モード |
| `(?s:pattern)` | パターン内でのみDOTALL |
| `(?x:pattern)` | パターン内でのみ拡張モード |

### グローバル修飾子

| 構文 | 説明 |
|------|------|
| `(?^)` | すべてのフラグをリセット |
| `(?^i)` | 大文字小文字無視のみ有効 |

## コメント

| 構文 | 説明 |
|------|------|
| `(?# comment)` | インラインコメント |
| `(?x)` | 拡張モード（空白とコメント許可） |

```regex
(?x)
    ^                   # 行の開始
    (?P<protocol>https?) # プロトコル
    ://                 # 区切り
    (?P<domain>[^/]+)   # ドメイン
    (?P<path>/.*)?      # パス（オプション）
    $                   # 行の終了
```

## エラーと警告

### 一般的なエラー

| パターン | エラー | 修正 |
|----------|--------|------|
| `[a-` | 未終了文字クラス | `[a-z]` |
| `(?P<>pattern)` | 空のグループ名 | `(?P<name>pattern)` |
| `\k<unknown>` | 未定義グループ | 正しいグループ名 |
| `{5,3}` | 無効な範囲 | `{3,5}` |

### パフォーマンス警告

| パターン | 問題 | 改善案 |
|----------|------|--------|
| `(a+)+` | 破滅的バックトラッキング | `a+` |
| `.*.*` | 冗長な量詞 | `.*` |
| `(a\|a)` | 重複選択 | `a` |

## 互換性

### PCRE互換性

CL-Regexは基本的にPCRE互換ですが、以下の拡張があります：

- 可変長後読み
- 日本語特化構文
- マクロシステム
- プロパティベース最適化

### ECMAScript互換性

ECMAScriptとの主な違い：

- Unicode正規化サポート
- 完全なUnicodeプロパティサポート
- 拡張された後読み

## パフォーマンス考慮事項

### 効率的なパターン

```regex
# Good
^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$

# Bad
^.*@.*\..*$
```

### 避けるべきパターン

```regex
# 破滅的バックトラッキング
(a+)+b

# 改善版
a+b
```

## 使用例

### 基本的な例

```regex
# 英数字3-16文字のユーザー名
^[a-zA-Z0-9]{3,16}$

# 日本の郵便番号
^\d{3}-\d{4}$

# URL
^https?://[a-zA-Z0-9.-]+(?:\.[a-zA-Z]{2,})+(?:/[^\s]*)?$
```

### 高度な例

```regex
# ネストした括弧（再帰使用）
\((?:[^()]|(?R))*\)

# バランスの取れたHTMLタグ
<(?P<tag>\w+)(?:[^>]*)>.*?</(?P=tag)>

# 複雑なパスワード検証
^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$
```