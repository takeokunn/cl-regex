# 演算子リファレンス

CL-Regexで利用可能な演算子の完全なリファレンスです。

## 基本演算子

### 連結演算子

| 演算子 | 説明 | 優先順位 | 例 |
|--------|------|----------|-----|
| 暗黙 | パターンの連結 | 20 | `abc` → "abc" |

### 選択演算子

| 演算子 | 説明 | 優先順位 | 例 |
|--------|------|----------|-----|
| `\|` | 選択（OR） | 5 | `a\|b` → "a" または "b" |

### 量詞演算子

| 演算子 | 説明 | 優先順位 | 例 |
|--------|------|----------|-----|
| `?` | 0回または1回 | 15 | `a?` |
| `*` | 0回以上 | 15 | `a*` |
| `+` | 1回以上 | 15 | `a+` |
| `{n}` | 正確にn回 | 15 | `a{3}` |
| `{n,}` | n回以上 | 15 | `a{3,}` |
| `{n,m}` | n回からm回 | 15 | `a{3,5}` |

## 文字クラス演算子

### 基本文字クラス

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `[...]` | 文字クラス | `[abc]` |
| `[^...]` | 否定文字クラス | `[^abc]` |
| `[a-z]` | 範囲指定 | `[a-z]`, `[0-9]` |

### 定義済み文字クラス

| 演算子 | 説明 | 等価表現 |
|--------|------|----------|
| `.` | 任意の文字 | `[^\n\r]` |
| `\d` | 数字 | `[0-9]` |
| `\D` | 数字以外 | `[^0-9]` |
| `\w` | 単語文字 | `[a-zA-Z0-9_]` |
| `\W` | 単語文字以外 | `[^a-zA-Z0-9_]` |
| `\s` | 空白文字 | `[ \t\n\r\f\v]` |
| `\S` | 空白文字以外 | `[^ \t\n\r\f\v]` |

## Unicode演算子

### General Category演算子

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `\p{L}` | 文字 | すべての文字 |
| `\p{Lu}` | 大文字 | A, Α |
| `\p{Ll}` | 小文字 | a, α |
| `\p{Lt}` | タイトル文字 | Dz |
| `\p{Lm}` | 修飾文字 | ʰ |
| `\p{Lo}` | その他文字 | あ, 字 |
| `\p{M}` | マーク | 結合文字 |
| `\p{N}` | 数字 | 1, Ⅰ, ① |
| `\p{P}` | 句読点 | ., ! |
| `\p{S}` | 記号 | $, © |
| `\p{Z}` | 区切り文字 | space |
| `\p{C}` | その他 | 制御文字 |

### Script演算子

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `\p{Latin}` | ラテン文字 | a, é |
| `\p{Hiragana}` | ひらがな | あ, か |
| `\p{Katakana}` | カタカナ | ア, カ |
| `\p{Han}` | 漢字 | 字, 漢 |
| `\p{Arabic}` | アラビア文字 | ع, ر |
| `\p{Cyrillic}` | キリル文字 | а, я |
| `\p{Greek}` | ギリシャ文字 | α, β |

### Block演算子

| 演算子 | 説明 | 範囲 |
|--------|------|------|
| `\p{InBasic_Latin}` | 基本ラテン文字 | U+0000-U+007F |
| `\p{InHiragana}` | ひらがな | U+3040-U+309F |
| `\p{InKatakana}` | カタカナ | U+30A0-U+30FF |
| `\p{InCJK_Unified_Ideographs}` | CJK統合漢字 | U+4E00-U+9FFF |

## グループ演算子

### キャプチャグループ

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `(...)` | キャプチャグループ | `(abc)` |
| `(?P<name>...)` | 名前付きキャプチャ | `(?P<word>\w+)` |
| `(?<name>...)` | 名前付きキャプチャ（.NET） | `(?<word>\w+)` |

### 非キャプチャグループ

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `(?:...)` | 非キャプチャグループ | `(?:abc)` |
| `(?>...)` | アトミックグループ | `(?>a+)b` |

## アンカー演算子

| 演算子 | 説明 | 動作 |
|--------|------|------|
| `^` | 行の開始 | 行頭位置 |
| `$` | 行の終了 | 行末位置 |
| `\A` | 文字列の開始 | 文字列の最初 |
| `\Z` | 文字列の終了 | 文字列の最後（改行前） |
| `\z` | 文字列の絶対終了 | 文字列の絶対最後 |
| `\b` | 単語境界 | 単語と非単語の境界 |
| `\B` | 非単語境界 | 単語境界以外 |
| `\G` | 前回マッチ終了位置 | 連続マッチの開始点 |

## 先読み・後読み演算子

### 先読み演算子

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `(?=...)` | 正の先読み | `\w+(?=\s)` |
| `(?!...)` | 負の先読み | `\w+(?!\s)` |

### 後読み演算子

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `(?<=...)` | 正の後読み | `(?<=\s)\w+` |
| `(?<!...)` | 負の後読み | `(?<!\s)\w+` |

### CL-Regex拡張後読み

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `(?<*...)` | 可変長正の後読み | `(?<*\w+)\d+` |
| `(?<!*...)` | 可変長負の後読み | `(?<!*\w+)\d+` |

## 条件付き演算子

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `(?(cond)yes)` | 条件付きマッチ | `(?(1)a)` |
| `(?(cond)yes\|no)` | 条件付き選択 | `(?(1)a\|b)` |
| `(?(<name>)yes\|no)` | 名前付き条件 | `(?(<word>)a\|b)` |

## バックリファレンス演算子

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `\1`, `\2`, ... | 番号付きバックリファレンス | `(a+)\1` |
| `\k<name>` | 名前付きバックリファレンス | `(?P<w>\w+)\k<w>` |
| `(?P=name)` | 名前付きバックリファレンス | `(?P<w>\w+)(?P=w)` |

## 再帰・サブルーチン演算子

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `(?R)` | 全体パターンの再帰 | `\((?:[^()]|(?R))*\)` |
| `(?0)` | 全体パターンの再帰 | `(?0)` |
| `(?1)`, `(?2)`, ... | グループのサブルーチン | `(a+)(?1)` |
| `(?P>name)` | 名前付きサブルーチン | `(?P<p>a+)(?P>p)` |

## フラグ演算子

### グローバルフラグ

| 演算子 | 説明 | 効果 |
|--------|------|------|
| `(?i)` | 大文字小文字無視 | A = a |
| `(?m)` | 複数行モード | ^ $ が各行に適用 |
| `(?s)` | DOTALL | . が改行にマッチ |
| `(?x)` | 拡張モード | 空白とコメント無視 |
| `(?u)` | Unicode | Unicode文字プロパティ有効 |
| `(?a)` | ASCII | ASCII文字のみ |

### フラグ無効化

| 演算子 | 説明 |
|--------|------|
| `(?-i)` | 大文字小文字区別 |
| `(?-m)` | 単一行モード |
| `(?-s)` | DOTALL無効 |
| `(?-x)` | 拡張モード無効 |

### インラインフラグ

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `(?i:...)` | 部分的な大文字小文字無視 | `(?i:abc)def` |
| `(?m:...)` | 部分的な複数行モード | `(?m:^start)` |
| `(?s:...)` | 部分的なDOTALL | `(?s:.)` |

## CL-Regex独自演算子

### マクロ演算子

| 演算子 | 説明 | 展開後 |
|--------|------|--------|
| `{:email}` | メールアドレス | `[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}` |
| `{:url}` | URL | `https?://[a-zA-Z0-9.-]+(?:\.[a-zA-Z]{2,})+(?:/[^\s]*)?` |
| `{:ip}` | IPアドレス | `(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}...` |
| `{:date}` | 日付 | `\d{4}-\d{2}-\d{2}` |
| `{:time}` | 時刻 | `\d{2}:\d{2}(?::\d{2})?` |

### 日本語演算子

| 演算子 | 説明 | 等価表現 |
|--------|------|----------|
| `{:hiragana}` | ひらがな | `\p{InHiragana}` |
| `{:katakana}` | カタカナ | `\p{InKatakana}` |
| `{:kanji}` | 漢字 | `\p{InCJK_Unified_Ideographs}` |
| `{:jp-word}` | 日本語単語 | `[\p{InHiragana}\p{InKatakana}\p{InCJK_Unified_Ideographs}]+` |

### 数値演算子

| 演算子 | 説明 | パターン |
|--------|------|----------|
| `{:integer}` | 整数 | `[+-]?\d+` |
| `{:decimal}` | 小数 | `[+-]?\d+(?:\.\d+)?` |
| `{:currency}` | 通貨 | `[$¥€£]\d+(?:\.\d{2})?` |
| `{:percentage}` | パーセント | `\d+(?:\.\d+)?%` |

### 高度な文字クラス演算子

| 演算子 | 説明 | 例 |
|--------|------|-----|
| `\p{Word}` | 単語文字（Unicode） | `\p{L}\p{N}_` |
| `\p{Alpha}` | アルファベット | `\p{L}` |
| `\p{Alnum}` | 英数字 | `\p{L}\p{N}` |
| `\p{Blank}` | 空白 | ` \t` |
| `\p{Cntrl}` | 制御文字 | `\p{Cc}` |
| `\p{Graph}` | グラフィック文字 | `\p{L}\p{M}\p{N}\p{P}\p{S}` |
| `\p{Print}` | 印刷可能文字 | `\p{Graph}\p{Zs}` |
| `\p{Punct}` | 句読点 | `\p{P}` |
| `\p{Space}` | 空白文字 | `\p{Z}\t\n\r\f\v` |
| `\p{Upper}` | 大文字 | `\p{Lu}` |
| `\p{Lower}` | 小文字 | `\p{Ll}` |
| `\p{Xdigit}` | 16進数字 | `[0-9A-Fa-f]` |

## 演算子の優先順位

| 優先順位 | 演算子 | 結合性 |
|----------|--------|--------|
| 20 | 連結 | 左 |
| 15 | `? * + {}` | 左 |
| 10 | `^$ \A \Z \z \b \B \G` | なし |
| 8 | `(?= (?! (?<= (?<!` | なし |
| 7 | グループ化 `()` | なし |
| 5 | 選択 `\|` | 左 |

## パフォーマンス特性

### 効率的な演算子

| 演算子分類 | 計算量 | 備考 |
|------------|--------|------|
| リテラル | O(n) | 最高効率 |
| 文字クラス | O(n) | 高効率 |
| アンカー | O(1) | 位置チェックのみ |
| 量詞（単純） | O(n) | バックトラッキングなし |

### 注意が必要な演算子

| 演算子 | 問題 | 対策 |
|--------|------|------|
| `(a+)+` | 破滅的バックトラッキング | `a+` に簡略化 |
| `.*.*` | 冗長 | `.*` に簡略化 |
| `(?=.*a)(?=.*b)` | 複数先読み | 単一パターンに統合 |

## 使用例

### 基本的な組み合わせ

```regex
# 単語の境界
\b\w+\b

# 行の開始と終了
^.*$

# 非貪欲量詞
.*?

# 名前付きキャプチャ
(?P<name>\w+)
```

### 高度な組み合わせ

```regex
# 条件付きマッチング
(a)?(?(1)b|c)

# 再帰パターン
\((?:[^()]|(?R))*\)

# 複数の先読み
(?=.*[a-z])(?=.*[A-Z])(?=.*\d).*

# バックリファレンス
(['"])(.*?)\1
```

### CL-Regex独自機能

```regex
# マクロの組み合わせ
{:email}|{:url}

# 日本語処理
{:jp-word}+

# 条件付きマクロ
(?(japanese){:jp-word}|{:word})
```

## デバッグとトラブルシューティング

### 一般的な問題

| 問題 | 原因 | 解決策 |
|------|------|--------|
| 意図しないマッチ | 貪欲量詞 | 非貪欲量詞使用 |
| パフォーマンス低下 | 破滅的バックトラッキング | パターン見直し |
| 文字化け | Unicode設定 | `(?u)` フラグ使用 |

### パフォーマンス最適化

```regex
# 悪い例
(a|a)*

# 良い例
a*

# 悪い例
.*foo.*bar.*

# 良い例
.*foo.*bar
```

## 拡張性

### カスタム演算子の定義

```lisp
;; 新しい演算子の定義例
(defoperator phone-number ()
  "\\(?\\d{3}\\)?[-. ]?\\d{3}[-. ]?\\d{4}")
```

### プラグインシステム

演算子はプラグインとして動的に追加可能：

- 実行時登録
- 優先順位の指定
- 名前空間の管理